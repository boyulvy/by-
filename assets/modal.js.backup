export function initModalSystem() {
  window.showModal = function (type = '', props = {}) {
    const modalRoot = document.getElementById('modal-root')
    const html = getModalContent(type, props)
    modalRoot.innerHTML = `
      <div class="modal-overlay" onclick="window.closeModal()"></div>
      <div class="modal">${html}<button class="modal-close" onclick="window.closeModal()">&times;</button></div>
    `
    modalRoot.style.display = 'block'
    setTimeout(() => {
      const firstInput = modalRoot.querySelector('input,button,select,textarea')
      if (firstInput) firstInput.focus()
    }, 200)
  }

  window.closeModal = function () {
    const modalRoot = document.getElementById('modal-root')
    modalRoot.innerHTML = ''
    modalRoot.style.display = 'none'
  }

  function getModalContent(type, props) {
    switch (type) {
      case 'quick-login':
        return quickLoginModal()
      case 'domain-verify':
        return domainVerifyModal()
      case 'ip-switch':
        return ipSwitchModal()
      case 'vpn':
        return vpnModal()
      case 'wallet':
        return walletModal()
      case 'register':
        return registerModal()
      case 'tutorial':
        return tutorialModal(props.tutorialType || 'okx')
      case 'customer':
        return customerModal()
      case 'app-download':
        return appDownloadModal()
      case 'tools':
        return toolsModal()
      default:
        return `<h3>å¼¹çª—å†…å®¹æœªå®šä¹‰</h3>`
    }
  }

  // åŸŸåéªŒè¯å¼¹çª—
  function domainVerifyModal() {
    return `
      <h3>åŸŸåéªŒè¯ä¸­å¿ƒ</h3>
      <div>
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600;">å•ä¸ªåŸŸåéªŒè¯ï¼š</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" id="verify-domain-input" placeholder="è¯·è¾“å…¥è¦éªŒè¯çš„åŸŸåï¼ˆå¦‚ï¼šexample.comï¼‰" style="flex: 1;">
            <button onclick="window.verifyDomain()"><i class="fas fa-search"></i> éªŒè¯</button>
          </div>
        </div>
        
        <div style="margin: 16px 0; text-align: center;">
          <div style="font-weight: 600; color: #4682e4; margin-bottom: 8px;">æˆ–</div>
          <button onclick="window.testAllDomains()" style="background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
            <i class="fas fa-globe"></i> æµ‹è¯•æ‰€æœ‰åŸŸåå“åº”é€Ÿåº¦
          </button>
        </div>
        
        <div id="verify-domain-result" style="margin-top:12px;"></div>
        
        <div style="margin-top: 16px; text-align: center;">
          <button class="secondary" onclick="window.closeModal()">å…³é—­</button>
        </div>
      </div>
    `
  }

  window.verifyDomain = function () {
    const input = document.getElementById('verify-domain-input')
    const result = document.getElementById('verify-domain-result')
    if (!input.value) {
      result.innerHTML =
        '<div class="modal-result result-error"><i class="fas fa-exclamation-circle"></i> è¯·è¾“å…¥åŸŸå</div>'
      return
    }
    result.innerHTML =
      '<div class="modal-result result-info"><i class="fas fa-spinner fa-spin"></i> éªŒè¯ä¸­...</div>'
    setTimeout(() => {
      const responseTime = Math.floor(Math.random() * 500) + 100
      const status = responseTime < 200 ? 'ä¼˜ç§€' : responseTime < 350 ? 'è‰¯å¥½' : 'ä¸€èˆ¬'
      const statusColor = responseTime < 200 ? '#4CAF50' : responseTime < 350 ? '#FF9800' : '#F44336'

      result.innerHTML = `
        <div class="modal-result result-success">
          <h4><i class="fas fa-check-circle"></i> ${input.value} éªŒè¯ç»“æœ</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px;">
            <div><strong>å“åº”æ—¶é—´:</strong> <span style="color: ${statusColor};">${responseTime}ms</span></div>
            <div><strong>çŠ¶æ€:</strong> <span style="color: ${statusColor};">${status}</span></div>
            <div><strong>DNSè§£æ:</strong> <span style="color: #4CAF50;">æ­£å¸¸</span></div>
            <div><strong>SSLè¯ä¹¦:</strong> <span style="color: #4CAF50;">æœ‰æ•ˆ</span></div>
          </div>
          <div style="margin-top: 12px; text-align: center;">
            <button onclick="window.open('https://${input.value}', '_blank')" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
              <i class="fas fa-external-link-alt"></i> è®¿é—®è¯¥åŸŸå
            </button>
          </div>
        </div>
      `
    }, 1000)
  }

  // æµ‹è¯•æ‰€æœ‰åŸŸååŠŸèƒ½
  window.testAllDomains = function () {
    const result = document.getElementById('verify-domain-result')

    result.innerHTML = `
      <div style="margin-bottom: 16px; padding: 12px; background: #e3f2fd; border-radius: 6px; border-left: 4px solid #2196F3;">
        <div style="font-weight: 600; color: #1976d2; margin-bottom: 8px;">
          <i class="fas fa-info-circle"></i> æ­£åœ¨æ£€æµ‹ç½‘ç»œç¯å¢ƒ...
        </div>
        <div id="ip-detection-info" style="font-size: 0.9em; color: #0d47a1;">
          æ­£åœ¨è·å–æ‚¨çš„IPåœ°å€å’Œåœ°ç†ä½ç½®ä¿¡æ¯...
        </div>
      </div>
      <div id="domain-speed-list">
        <div style="padding: 12px; text-align: center; color: #666;">
          <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æµ‹è¯•æ‰€æœ‰åŸŸåå“åº”é€Ÿåº¦...
        </div>
      </div>
    `

    // æ¨¡æ‹ŸIPæ£€æµ‹è¿‡ç¨‹
    setTimeout(() => {
      const mockIPInfo = generateMockIPInfo()
      document.getElementById('ip-detection-info').innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9em;">
          <div><strong>IPåœ°å€:</strong> ${mockIPInfo.ip}</div>
          <div><strong>ä½ç½®:</strong> ${mockIPInfo.location}</div>
          <div><strong>è¿è¥å•†:</strong> ${mockIPInfo.isp}</div>
          <div><strong>ç½‘ç»œç±»å‹:</strong> ${mockIPInfo.networkType}</div>
        </div>
      `

      // å¼€å§‹æµ‹è¯•åŸŸåé€Ÿåº¦
      setTimeout(() => {
        testDomainSpeeds()
      }, 1000)
    }, 1000)
  }

  // IPåˆ‡æ¢å¼¹çª—
  function ipSwitchModal() {
    return `
      <h3>æ™ºèƒ½IPåˆ‡æ¢</h3>
      <div>
        <label>é€‰æ‹©IPèŠ‚ç‚¹ï¼š</label>
        <select id="ip-region-select">
          <option value="cn">ä¸­å›½å¤§é™† (CN)</option>
          <option value="us">ç¾å›½ (US)</option>
          <option value="hk">é¦™æ¸¯ (HK)</option>
          <option value="jp">æ—¥æœ¬ (JP)</option>
          <option value="sg">æ–°åŠ å¡ (SG)</option>
          <option value="uk">è‹±å›½ (UK)</option>
        </select>
        <button onclick="window.switchIP()"><i class="fas fa-network-wired"></i> åˆ‡æ¢</button>
        <button class="secondary" onclick="window.closeModal()">å…³é—­</button>
      </div>
      <div id="ip-switch-result" style="margin-top:12px;"></div>
    `
  }

  window.switchIP = function () {
    const select = document.getElementById('ip-region-select')
    const result = document.getElementById('ip-switch-result')
    result.innerHTML =
      '<div class="modal-result result-info"><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åˆ‡æ¢...</div>'
    setTimeout(() => {
      const regionName = select.options[select.selectedIndex].text
      result.innerHTML = `<div class="modal-result result-success"><i class="fas fa-check-circle"></i> å·²æˆåŠŸåˆ‡æ¢è‡³ ${regionName} èŠ‚ç‚¹</div>`
    }, 1000)
  }

  // VPNå¼¹çª—
  function vpnModal() {
    return `
      <h3>VPNå·¥å…·ä¸‹è½½</h3>
      <div>
        <h4><i class="fas fa-shield-alt"></i> æ¨èVPNæœåŠ¡</h4>
        <table>
          <thead>
            <tr>
              <th>VPNåç§°</th>
              <th>ç‰¹æ€§</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>å¿«è¿VPN</strong></td>
              <td>æé€Ÿè¿æ¥ã€ç¨³å®šå¯é </td>
              <td>
                <button onclick="window.open('https://letsvpn.world/')"><i class="fas fa-download"></i> ä¸‹è½½</button>
                <button class="secondary" onclick="window.showModal('tutorial',{tutorialType:'kuailianvpn'})">æ•™ç¨‹</button>
              </td>
            </tr>
            <tr>
              <td><strong>é—ªè¿VPN</strong></td>
              <td>é—ªç”µè¿æ¥ã€é«˜é€Ÿç¨³å®š</td>
              <td>
                <button onclick="window.open('https://lightningxvpn.com/cn/')"><i class="fas fa-download"></i> ä¸‹è½½</button>
                <button class="secondary" onclick="window.showModal('tutorial',{tutorialType:'shanlienvpn'})">æ•™ç¨‹</button>
              </td>
            </tr>
            <tr>
              <td><strong>NordVPN</strong></td>
              <td>å›½é™…çŸ¥åã€å®‰å…¨åŠ å¯†</td>
              <td>
                <button onclick="window.open('https://www.nordvpn.com/zh-cn/download/')"><i class="fas fa-download"></i> ä¸‹è½½</button>
                <button class="secondary" onclick="window.showModal('tutorial',{tutorialType:'nordvpn'})">æ•™ç¨‹</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button onclick="window.closeModal()" style="margin-top:12px;"><i class="fas fa-times"></i> å…³é—­</button>
    `
  }

  // å¿«é€Ÿç™»å½•å¼¹çª—
  function quickLoginModal() {
    return `
      <h3>âš¡ å¿«é€Ÿç™»å½•</h3>
      <div>
        <div style="margin-bottom: 20px; padding: 16px; background: #e8f5e9; border-radius: 6px; border-left: 4px solid #4CAF50;">
          <div style="font-weight: 600; color: #2e7d32; margin-bottom: 8px;">
            <i class="fas fa-bolt"></i> æ™ºèƒ½å¿«é€Ÿç™»å½•
          </div>
          <div style="font-size: 0.9em; color: #1b5e20;">
            ç³»ç»Ÿå°†è‡ªåŠ¨æ£€æµ‹å¹¶è·³è½¬åˆ°å“åº”æœ€å¿«çš„åŸŸåç™»å½•é¡µé¢
          </div>
        </div>
        
        <div id="quick-login-status" style="margin-bottom: 16px; text-align: center; color: #666;">
          ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹å¿«é€Ÿç™»å½•
        </div>
        
        <div style="text-align: center; margin-top: 16px;">
          <button onclick="window.startQuickLogin()" style="background: #4CAF50; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: 600;">
            <i class="fas fa-bolt"></i> ç«‹å³å¿«é€Ÿç™»å½•
          </button>
          <button class="secondary" onclick="window.closeModal()" style="margin-left: 12px;">å–æ¶ˆ</button>
        </div>
      </div>
    `
  }

  // æ•°å­—é’±åŒ…å¼¹çª—
  function walletModal() {
    return `
      <h3>æ•°å­—é’±åŒ…å·¥å…·</h3>
      <div>
        <h4><i class="fas fa-wallet"></i> æ”¯æŒçš„é’±åŒ…</h4>
        <table>
          <thead>
            <tr>
              <th>é’±åŒ…åç§°</th>
              <th>åŠŸèƒ½ç‰¹æ€§</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>OKXé’±åŒ…</strong></td>
              <td>æ”¯æŒå¤šé“¾èµ„äº§ç®¡ç†ï¼Œæ¬§æ˜“å®˜æ–¹é’±åŒ…</td>
              <td>
                <button onclick="window.open('https://www.okx.com/download')"><i class="fas fa-download"></i> ä¸‹è½½</button>
                <button class="secondary" onclick="window.showModal('tutorial',{tutorialType:'okx'})">æ•™ç¨‹</button>
              </td>
            </tr>
            <tr>
              <td><strong>å¸å®‰é’±åŒ…</strong></td>
              <td>å¸å®‰å®˜æ–¹é’±åŒ…ï¼Œå®‰å…¨å¯é </td>
              <td>
                <button onclick="window.open('https://www.binance.com/')"><i class="fas fa-download"></i> ä¸‹è½½</button>
                <button class="secondary" onclick="window.showModal('tutorial',{tutorialType:'binance'})">æ•™ç¨‹</button>
              </td>
            </tr>
            <tr>
              <td><strong>Kè±†é’±åŒ…</strong></td>
              <td>å»ä¸­å¿ƒåŒ–é’±åŒ…ï¼Œè‡ªä¸»ç®¡ç†èµ„äº§</td>
              <td>
                <button onclick="window.open('https://kdxz08.com/home/#/')"><i class="fas fa-download"></i> ä¸‹è½½</button>
                <button class="secondary" onclick="window.showModal('tutorial',{tutorialType:'kd'})">æ•™ç¨‹</button>
              </td>
            </tr>
            <tr>
              <td><strong>Trust Wallet</strong></td>
              <td>å¤šé“¾é’±åŒ…ï¼Œæ”¯æŒDeFiåº”ç”¨</td>
              <td>
                <button onclick="window.open('https://trustwallet.com/')"><i class="fas fa-download"></i> ä¸‹è½½</button>
                <button class="secondary" onclick="window.showModal('tutorial',{tutorialType:'trust'})">æ•™ç¨‹</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button onclick="window.closeModal()" style="margin-top:12px;"><i class="fas fa-times"></i> å…³é—­</button>
    `
  }

  // å¿«é€Ÿæ³¨å†Œå¼¹çª—
  function registerModal() {
    return `
      <h3>å¿«é€Ÿæ³¨å†Œ</h3>
      <div>
        <label style="color: #4682e4; font-weight: 600; margin-bottom: 8px; display: block;">é€‰æ‹©æ³¨å†Œç½‘ç«™ï¼š</label>
        <select id="reg-target-site" style="width: 100%; padding: 8px; margin-bottom: 12px; border: 1px solid #e3eaf5; border-radius: 6px;">
          <option value="">è¯·é€‰æ‹©ç›®æ ‡ç½‘ç«™</option>
          <option value="test.8yhot.com">ğŸ§ª æµ‹è¯•ç½‘ç«™ (APIè°ƒè¯•)</option>
          <option value="8y369.com">8y369.com - ä¸»è¦æ¸¸æˆå¹³å°</option>
          <option value="8y258.com">8y258.com - å¤‡ç”¨å¹³å°</option>
          <option value="8y68.com">8y68.com - ç²¾ç®€ç‰ˆ</option>
          <option value="8yapp.com">8yapp.com - ç§»åŠ¨ä¸“ç‰ˆ</option>
          <option value="8y520.com">8y520.com - é«˜çº§ä¼šå‘˜</option>
          <option value="8y668.com">8y668.com - VIPä¸“äº«</option>
          <option value="818by.com">818by.com - åšå½©ç‰ˆ</option>
          <option value="518by.com">518by.com - ç»¼åˆå¹³å°</option>
          <option value="81svip.com">81svip.com - è¶…çº§VIP</option>
          <option value="8y98.com">8y98.com - æ——èˆ°ç‰ˆ</option>
        </select>
        
        <input type="email" id="reg-email" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€">
        <input type="password" id="reg-pwd" placeholder="è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰">
        <input type="password" id="reg-pwd-confirm" placeholder="ç¡®è®¤å¯†ç ">
        <input type="text" id="reg-nickname" placeholder="è®¾ç½®æ˜µç§°">
        <input type="text" id="reg-phone" placeholder="æ‰‹æœºå·ç ï¼ˆå¯é€‰ï¼‰">
        
        <div style="margin: 12px 0;">
          <label style="display: flex; align-items: center; font-size: 0.9em; color: #666;">
            <input type="checkbox" id="reg-agree" style="margin-right: 8px;">
            æˆ‘åŒæ„æœåŠ¡æ¡æ¬¾å’Œéšç§æ”¿ç­–ï¼Œå¹¶æˆæƒåŒæ­¥æ³¨å†Œåˆ°é€‰å®šç½‘ç«™
          </label>
        </div>
        
        <button onclick="window.submitRegister()"><i class="fas fa-user-plus"></i> ç«‹å³æ³¨å†Œå¹¶åŒæ­¥</button>
        <button class="secondary" onclick="window.closeModal()">å–æ¶ˆ</button>
      </div>
      <div id="reg-result" style="margin-top:12px;"></div>
    `
  }

  window.submitRegister = function () {
    const targetSite = document.getElementById('reg-target-site').value
    const email = document.getElementById('reg-email').value.trim()
    const pwd = document.getElementById('reg-pwd').value
    const pwdConfirm = document.getElementById('reg-pwd-confirm').value
    const nick = document.getElementById('reg-nickname').value.trim()
    const phone = document.getElementById('reg-phone').value.trim()
    const agree = document.getElementById('reg-agree').checked
    const result = document.getElementById('reg-result')

    // éªŒè¯è¾“å…¥
    if (!targetSite) {
      result.innerHTML =
        '<div class="modal-result result-error"><i class="fas fa-exclamation-circle"></i> è¯·é€‰æ‹©è¦æ³¨å†Œçš„ç›®æ ‡ç½‘ç«™</div>'
      return
    }
    if (!email || !pwd || !pwdConfirm || !nick) {
      result.innerHTML =
        '<div class="modal-result result-error"><i class="fas fa-exclamation-circle"></i> è¯·å¡«å†™å¿…å¡«å­—æ®µ</div>'
      return
    }
    if (!agree) {
      result.innerHTML =
        '<div class="modal-result result-error"><i class="fas fa-exclamation-circle"></i> è¯·åŒæ„æœåŠ¡æ¡æ¬¾å’ŒæˆæƒåŒæ­¥æ³¨å†Œ</div>'
      return
    }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      result.innerHTML =
        '<div class="modal-result result-error"><i class="fas fa-exclamation-circle"></i> é‚®ç®±æ ¼å¼ä¸æ­£ç¡®</div>'
      return
    }
    if (pwd.length < 6) {
      result.innerHTML =
        '<div class="modal-result result-error"><i class="fas fa-exclamation-circle"></i> å¯†ç éœ€è‡³å°‘6ä½</div>'
      return
    }
    if (pwd !== pwdConfirm) {
      result.innerHTML =
        '<div class="modal-result result-error"><i class="fas fa-exclamation-circle"></i> ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´</div>'
      return
    }

    // å¼€å§‹æ³¨å†Œæµç¨‹
    result.innerHTML =
      '<div class="modal-result result-info"><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æ³¨å†Œæœ¬åœ°è´¦æˆ·...</div>'

    // æ¨¡æ‹Ÿæœ¬åœ°æ³¨å†Œ
    setTimeout(() => {
      result.innerHTML =
        '<div class="modal-result result-info"><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŒæ­¥æ³¨å†Œåˆ°ç›®æ ‡ç½‘ç«™...</div>'

      // æ‰§è¡ŒåŒæ­¥æ³¨å†Œ
      syncRegisterToTargetSite(targetSite, {
        email: email,
        password: pwd,
        nickname: nick,
        phone: phone
      }, result)
    }, 1000)
  }

  // åŒæ­¥æ³¨å†Œåˆ°ç›®æ ‡ç½‘ç«™ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼‰
  async function syncRegisterToTargetSite(targetSite, userData, resultElement) {
    try {
      // æ˜¾ç¤ºæ³¨å†Œè¿›åº¦
      resultElement.innerHTML =
        `<div class="modal-result result-info"><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨å‘ ${targetSite} æäº¤æ³¨å†Œä¿¡æ¯...</div>`

      // ç”Ÿæˆç™»å½•ä»¤ç‰Œ
      const loginToken = generateLoginToken(userData.email, targetSite)

      // æ¨¡æ‹ŸAPIè°ƒç”¨è¿‡ç¨‹ï¼ˆå› ä¸ºå¤§å¤šæ•°ç›®æ ‡ç½‘ç«™æ²¡æœ‰å…¬å¼€APIï¼‰
      await new Promise(resolve => setTimeout(resolve, 2000))

      // æ£€æŸ¥æ˜¯å¦ä¸ºæµ‹è¯•ç¯å¢ƒ
      const isTestSite = targetSite.includes('test') || targetSite.includes('localhost')

      if (isTestSite) {
        // æµ‹è¯•ç¯å¢ƒï¼šæ¨¡æ‹ŸæˆåŠŸ
        resultElement.innerHTML = `
          <div class="modal-result result-success">
            <h4><i class="fas fa-check-circle"></i> æµ‹è¯•æ³¨å†ŒæˆåŠŸï¼</h4>
            <div style="margin: 12px 0; padding: 12px; background: #f0f7ff; border-radius: 6px; border-left: 4px solid #4682e4;">
              <div><strong>æµ‹è¯•è´¦æˆ·ä¿¡æ¯ï¼š</strong></div>
              <div>ğŸ“§ é‚®ç®±ï¼š${userData.email}</div>
              <div>ğŸ‘¤ æ˜µç§°ï¼š${userData.nickname}</div>
              <div>ğŸŒ æ³¨å†Œç½‘ç«™ï¼š${targetSite}</div>
              <div>ğŸ” ç™»å½•ä»¤ç‰Œï¼š${loginToken}</div>
              <div style="color: #10b981; font-weight: 600;">âœ… æµ‹è¯•ç¯å¢ƒæ³¨å†ŒæˆåŠŸ</div>
            </div>
            <div style="margin: 12px 0;">
              <button onclick="window.copyLoginInfo('${targetSite}', '${userData.email}', '${loginToken}')" 
                      style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                <i class="fas fa-copy"></i> å¤åˆ¶ç™»å½•ä¿¡æ¯
              </button>
            </div>
          </div>
        `

        // ä¿å­˜æµ‹è¯•æ³¨å†Œä¿¡æ¯
        saveRegistrationInfo(targetSite, userData, loginToken, true)

      } else {
        // ç”Ÿäº§ç¯å¢ƒï¼šå¼•å¯¼æ‰‹åŠ¨æ³¨å†Œ
        resultElement.innerHTML = `
          <div class="modal-result result-warning">
            <h4><i class="fas fa-info-circle"></i> éœ€è¦æ‰‹åŠ¨å®Œæˆæ³¨å†Œ</h4>
            <div style="margin: 12px 0; padding: 12px; background: #fef3c7; border-radius: 6px; border-left: 4px solid #f59e0b;">
              <div><strong>æ³¨å†Œå¼•å¯¼ï¼š</strong></div>
              <div>ğŸ“§ é‚®ç®±ï¼š${userData.email}</div>
              <div>ğŸ‘¤ æ˜µç§°ï¼š${userData.nickname}</div>
              <div>ğŸŒ ç›®æ ‡ç½‘ç«™ï¼š${targetSite}</div>
              <div style="margin-top: 8px; font-size: 0.9em; color: #92400e;">
                <strong>æ“ä½œæ­¥éª¤ï¼š</strong><br>
                1. ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è®¿é—® ${targetSite}<br>
                2. ä½¿ç”¨ä¸Šè¿°ä¿¡æ¯å®Œæˆæ‰‹åŠ¨æ³¨å†Œ<br>
                3. æ³¨å†ŒæˆåŠŸåç‚¹å‡»"ç¡®è®¤å®Œæˆ"æŒ‰é’®
              </div>
            </div>
            <div style="margin: 12px 0;">
              <button onclick="window.openRegistrationSite('${targetSite}', '${userData.email}', '${userData.password}', '${userData.nickname}')" 
                      style="background: #f59e0b; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-right: 8px;">
                <i class="fas fa-external-link-alt"></i> å‰å¾€ ${targetSite} æ³¨å†Œ
              </button>
              <button onclick="window.copyRegistrationInfo('${targetSite}', '${userData.email}', '${userData.password}', '${userData.nickname}')" 
                      style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                <i class="fas fa-copy"></i> å¤åˆ¶æ³¨å†Œä¿¡æ¯
              </button>
            </div>
            <div style="margin: 12px 0;">
              <button onclick="window.confirmManualRegistration('${targetSite}', '${userData.email}', '${loginToken}')" 
                      style="background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                <i class="fas fa-check"></i> ç¡®è®¤å·²å®Œæˆæ³¨å†Œ
              </button>
            </div>
            <div style="font-size: 0.9em; color: #666; margin-top: 8px;">
              ğŸ’¡ æç¤ºï¼šç”±äºç›®æ ‡ç½‘ç«™å®‰å…¨ç­–ç•¥ï¼Œéœ€è¦æ‰‹åŠ¨å®Œæˆæ³¨å†Œè¿‡ç¨‹
            </div>
          </div>
        `

        // ä¿å­˜æ³¨å†Œä¿¡æ¯ï¼ˆæ ‡è®°ä¸ºå¾…ç¡®è®¤ï¼‰
        const registrationInfo = {
          ...userData,
          manual: true,
          confirmed: false,
          password: userData.password // ä¸´æ—¶ä¿å­˜å¯†ç ç”¨äºå¤åˆ¶
        }
        saveRegistrationInfo(targetSite, registrationInfo, loginToken, false)
      }

    } catch (error) {
      console.error('æ³¨å†Œè¿‡ç¨‹å¤±è´¥:', error)
      resultElement.innerHTML = `
        <div class="modal-result result-error">
          <i class="fas fa-exclamation-circle"></i> 
          æ³¨å†Œè¿‡ç¨‹å‡ºç°é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•
          <div style="margin: 12px 0;">
            <button onclick="window.retryRegistration('${targetSite}')" 
                    style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 8px;">
              <i class="fas fa-redo"></i> é‡è¯•
            </button>
            <button onclick="window.open('https://${targetSite}', '_blank')" 
                    style="background: #6b7280; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
              <i class="fas fa-external-link-alt"></i> æ‰‹åŠ¨æ³¨å†Œ
            </button>
          </div>
        </div>
      `
    }
  }

  // ç®€åŒ–çš„Toastæç¤ºå‡½æ•°ï¼ˆç”¨äºmodal.jsï¼‰
  function showToast(message, type = 'info') {
    const colors = {
      'success': 'linear-gradient(135deg, #10b981, #34d399)',
      'error': 'linear-gradient(135deg, #ef4444, #f87171)',
      'info': 'linear-gradient(135deg, #3b82f6, #60a5fa)',
      'warning': 'linear-gradient(135deg, #f59e0b, #fbbf24)'
    }

    const toast = document.createElement('div')
    toast.textContent = message
    toast.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${colors[type] || colors.info};
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 10001;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      animation: slideInRight 0.3s ease-out;
      max-width: 300px;
      word-wrap: break-word;
    `

    document.body.appendChild(toast)

    setTimeout(() => {
      if (toast.parentNode) {
        toast.style.animation = 'slideOutRight 0.3s ease-in'
        setTimeout(() => {
          if (toast.parentNode) {
            document.body.removeChild(toast)
          }
        }, 300)
      }
    }, 4000)
  }

  // ç”Ÿæˆç™»å½•ä»¤ç‰Œ
  function generateLoginToken(email, targetSite) {
    const timestamp = Date.now()
    const randomStr = Math.random().toString(36).substring(2, 15)
    const hashBase = `${email}_${targetSite}_${timestamp}_${randomStr}`
    // ç®€å•çš„base64ç¼–ç ä½œä¸ºä»¤ç‰Œï¼ˆå®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹æ³•ï¼‰
    return btoa(hashBase).substring(0, 32)
  }

  // ä¿å­˜æ³¨å†Œä¿¡æ¯åˆ°æœ¬åœ°å­˜å‚¨
  function saveRegistrationInfo(targetSite, userData, loginToken, isSuccess = false) {
    try {
      const registrationData = {
        targetSite: targetSite,
        email: userData.email,
        nickname: userData.nickname,
        phone: userData.phone || '',
        loginToken: loginToken,
        registeredAt: new Date().toISOString(),
        lastLogin: null,
        manual: !isSuccess,
        confirmed: isSuccess
      }

      // è·å–ç°æœ‰çš„æ³¨å†Œè®°å½•
      const existingRecords = JSON.parse(localStorage.getItem('syncRegistrations') || '[]')

      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒç½‘ç«™çš„æ³¨å†Œè®°å½•
      const existingIndex = existingRecords.findIndex(record =>
        record.targetSite === targetSite && record.email === userData.email
      )

      if (existingIndex >= 0) {
        // æ›´æ–°ç°æœ‰è®°å½•
        existingRecords[existingIndex] = registrationData
      } else {
        // æ·»åŠ æ–°è®°å½•
        existingRecords.push(registrationData)
      }

      // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem('syncRegistrations', JSON.stringify(existingRecords))

      console.log('æ³¨å†Œä¿¡æ¯å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨')
    } catch (error) {
      console.error('ä¿å­˜æ³¨å†Œä¿¡æ¯å¤±è´¥:', error)
    }
  }

  // æ‰“å¼€æ³¨å†Œç½‘ç«™
  window.openRegistrationSite = function (targetSite, email, password, nickname) {
    // æ„å»ºURLï¼Œåœ¨ç›®æ ‡ç½‘ç«™é¡µé¢é¢„å¡«ä¿¡æ¯ï¼ˆå¦‚æœæ”¯æŒï¼‰
    const registrationUrl = `https://${targetSite}/register?ref=8yhot&email=${encodeURIComponent(email)}`

    // åœ¨æ–°çª—å£æ‰“å¼€æ³¨å†Œé¡µé¢
    const newWindow = window.open(registrationUrl, '_blank', 'noopener,noreferrer')

    if (newWindow) {
      showToast('æ­£åœ¨æ‰“å¼€ç›®æ ‡ç½‘ç«™æ³¨å†Œé¡µé¢...', 'info')
    } else {
      alert('æ–°çª—å£è¢«æµè§ˆå™¨é˜»æ­¢ï¼Œè¯·å…è®¸å¼¹çª—åé‡è¯•ï¼Œæˆ–æ‰‹åŠ¨è®¿é—®ï¼š' + registrationUrl)
    }
  }

  // ç™»å½•åˆ°ç›®æ ‡ç½‘ç«™
  window.loginToTargetSite = function (targetSite, loginToken) {
    try {
      // æ„å»ºç™»å½•URLï¼ŒåŒ…å«ä»¤ç‰Œä¿¡æ¯
      const loginUrl = `https://${targetSite}/?autoLogin=true&token=${loginToken}&source=8yhot`

      // æ›´æ–°æœ€åç™»å½•æ—¶é—´
      updateLastLoginTime(targetSite, loginToken)

      // åœ¨æ–°çª—å£æ‰“å¼€ç›®æ ‡ç½‘ç«™
      const newWindow = window.open(loginUrl, '_blank', 'noopener,noreferrer')

      if (newWindow) {
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        const result = document.getElementById('reg-result')
        if (result) {
          const successMsg = document.createElement('div')
          successMsg.innerHTML = `
            <div class="modal-result result-info" style="margin-top: 12px;">
              <i class="fas fa-external-link-alt"></i> 
              æ­£åœ¨è·³è½¬åˆ° ${targetSite}ï¼Œè¯·ç¨å€™...
              <div style="font-size: 0.9em; margin-top: 8px; color: #666;">
                å¦‚æœé¡µé¢æœªè‡ªåŠ¨ç™»å½•ï¼Œè¯·ä½¿ç”¨ä¿å­˜çš„ç™»å½•ä»¤ç‰Œæ‰‹åŠ¨ç™»å½•
              </div>
            </div>
          `
          result.appendChild(successMsg)
        }

        // 3ç§’åå…³é—­å¼¹çª—
        setTimeout(() => {
          window.closeModal()
        }, 3000)

      } else {
        alert('æ–°çª—å£è¢«æµè§ˆå™¨é˜»æ­¢ï¼Œè¯·å…è®¸å¼¹çª—åé‡è¯•ï¼Œæˆ–æ‰‹åŠ¨è®¿é—®ï¼š' + loginUrl)
      }

    } catch (error) {
      console.error('ç™»å½•è·³è½¬å¤±è´¥:', error)
      alert('ç™»å½•è·³è½¬å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è®¿é—®ç›®æ ‡ç½‘ç«™å¹¶ä½¿ç”¨ç™»å½•ä»¤ç‰Œç™»å½•')
    }
  }

  // å¤åˆ¶ç™»å½•ä¿¡æ¯
  window.copyLoginInfo = function (targetSite, email, loginToken) {
    const loginInfo = `ç½‘ç«™: ${targetSite}
é‚®ç®±: ${email}
ç™»å½•ä»¤ç‰Œ: ${loginToken}
ç™»å½•åœ°å€: https://${targetSite}/?autoLogin=true&token=${loginToken}&source=8yhot

è¯·ä¿å­˜æ­¤ä¿¡æ¯ï¼Œå¯ç”¨äºå¿«é€Ÿç™»å½•ç›®æ ‡ç½‘ç«™ã€‚`

    navigator.clipboard.writeText(loginInfo).then(() => {
      // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
      const toast = document.createElement('div')
      toast.innerHTML = 'âœ… ç™»å½•ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 10001;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        animation: slideInRight 0.3s ease-out;
      `

      document.body.appendChild(toast)

      setTimeout(() => {
        if (toast.parentNode) {
          toast.style.animation = 'slideOutRight 0.3s ease-in'
          setTimeout(() => {
            if (toast.parentNode) {
              document.body.removeChild(toast)
            }
          }, 300)
        }
      }, 3000)

    }).catch(() => {
      // é™çº§æ–¹æ¡ˆï¼šæ˜¾ç¤ºä¿¡æ¯ä¾›ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
      alert('ç™»å½•ä¿¡æ¯ï¼š\n\n' + loginInfo)
    })
  }

  // æ›´æ–°æœ€åç™»å½•æ—¶é—´
  function updateLastLoginTime(targetSite, loginToken) {
    try {
      const registrations = JSON.parse(localStorage.getItem('syncRegistrations') || '[]')
      const registration = registrations.find(r => r.targetSite === targetSite && r.loginToken === loginToken)

      if (registration) {
        registration.lastLogin = new Date().toISOString()
        localStorage.setItem('syncRegistrations', JSON.stringify(registrations))
      }
    } catch (error) {
      console.error('æ›´æ–°ç™»å½•æ—¶é—´å¤±è´¥:', error)
    }
  }

  // å¤åˆ¶æ³¨å†Œä¿¡æ¯ï¼ˆç”¨äºæ‰‹åŠ¨æ³¨å†Œï¼‰
  window.copyRegistrationInfo = function (targetSite, email, password, nickname) {
    const registrationInfo = `ç›®æ ‡ç½‘ç«™: ${targetSite}
é‚®ç®±åœ°å€: ${email}
ç™»å½•å¯†ç : ${password}
ç”¨æˆ·æ˜µç§°: ${nickname}
æ³¨å†Œé“¾æ¥: https://${targetSite}

è¯·ä½¿ç”¨ä»¥ä¸Šä¿¡æ¯åœ¨ç›®æ ‡ç½‘ç«™æ‰‹åŠ¨å®Œæˆæ³¨å†Œã€‚`

    navigator.clipboard.writeText(registrationInfo).then(() => {
      showToast('âœ… æ³¨å†Œä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success')
    }).catch(() => {
      alert('æ³¨å†Œä¿¡æ¯ï¼š\n\n' + registrationInfo)
    })
  }

  // ç¡®è®¤å·²æ‰‹åŠ¨æ³¨å†Œ
  window.confirmManualRegistration = function (targetSite, email, loginToken) {
    if (confirm(`è¯·ç¡®è®¤æ‚¨å·²åœ¨ ${targetSite} ä½¿ç”¨é‚®ç®± ${email} å®Œæˆæ‰‹åŠ¨æ³¨å†Œã€‚\n\nç¡®è®¤åå°†æ›´æ–°æœ¬åœ°è®°å½•çŠ¶æ€ã€‚`)) {
      try {
        // æ›´æ–°æœ¬åœ°å­˜å‚¨è®°å½•
        let registrations = JSON.parse(localStorage.getItem('syncRegistrations') || '[]')
        const registration = registrations.find(r => r.targetSite === targetSite && r.email === email)

        if (registration) {
          registration.manual = true
          registration.confirmed = true
          registration.confirmedAt = new Date().toISOString()
          localStorage.setItem('syncRegistrations', JSON.stringify(registrations))

          // æ›´æ–°æ˜¾ç¤º
          const result = document.getElementById('reg-result')
          if (result) {
            result.innerHTML = `
              <div class="modal-result result-success">
                <h4><i class="fas fa-check-circle"></i> æ³¨å†Œç¡®è®¤æˆåŠŸï¼</h4>
                <div style="margin: 12px 0; padding: 12px; background: #f0f7ff; border-radius: 6px; border-left: 4px solid #4682e4;">
                  <div>âœ… å·²ç¡®è®¤åœ¨ ${targetSite} å®Œæˆæ‰‹åŠ¨æ³¨å†Œ</div>
                  <div>ğŸ“§ é‚®ç®±ï¼š${email}</div>
                  <div>ğŸ” ç™»å½•ä»¤ç‰Œï¼š${loginToken}</div>
                </div>
                <div style="margin: 12px 0;">
                  <button onclick="window.loginToTargetSite('${targetSite}', '${loginToken}')" 
                          style="background: #4682e4; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                    <i class="fas fa-sign-in-alt"></i> ç«‹å³ç™»å½• ${targetSite}
                  </button>
                </div>
              </div>
            `
          }

          showToast('âœ… æ³¨å†ŒçŠ¶æ€å·²ç¡®è®¤', 'success')
        }
      } catch (error) {
        console.error('ç¡®è®¤æ³¨å†ŒçŠ¶æ€å¤±è´¥:', error)
        showToast('âŒ ç¡®è®¤å¤±è´¥ï¼Œè¯·é‡è¯•', 'error')
      }
    }
  }

  // é‡è¯•æ³¨å†Œ
  window.retryRegistration = function (targetSite) {
    const email = document.getElementById('reg-email').value.trim()
    const pwd = document.getElementById('reg-pwd').value
    const nick = document.getElementById('reg-nickname').value.trim()
    const phone = document.getElementById('reg-phone').value.trim()
    const result = document.getElementById('reg-result')

    if (email && pwd && nick) {
      syncRegisterToTargetSite(targetSite, {
        email: email,
        password: pwd,
        nickname: nick,
        phone: phone
      }, result)
    } else {
      result.innerHTML =
        '<div class="modal-result result-error"><i class="fas fa-exclamation-circle"></i> è¯·æ£€æŸ¥è¾“å…¥ä¿¡æ¯åé‡è¯•</div>'
    }
  }

  // å®¢æœå¼¹çª—
  function customerModal() {
    return `
      <h3>å®¢æœä¸­å¿ƒ</h3>
      <div>
        <h4><i class="fas fa-headset"></i> è”ç³»æ–¹å¼</h4>
        <button onclick="window.open('mailto:boyu@81nb.com')" style="width:100%;"><i class="fas fa-envelope"></i> é‚®ä»¶å’¨è¯¢ (boyu@81nb.com)</button>
        <button onclick="window.open('https://www.b826419xp.com/Chat/Chat?userID=&userName=')" style="width:100%;"><i class="fas fa-comments"></i> åœ¨çº¿èŠå¤©</button>
        <button onclick="window.open('https://t.me/byyx_bot')" style="width:100%;"><i class="fab fa-telegram"></i> TGæœºå™¨äºº</button>
        <button onclick="window.open('https://whatsapp.com/channel/0029VbBMetjDjiObJx7lOq3L')" style="width:100%;"><i class="fab fa-whatsapp"></i> WhatsAppé¢‘é“</button>
        <h4 style="margin-top:16px;"><i class="fas fa-info-circle"></i> æœåŠ¡æ—¶é—´</h4>
        <p>Monday - Sunday: 09:00 - 03:00 (UTC+8)</p>
        <p>å·¥ä½œæ—¥ä¼˜å…ˆå“åº”ï¼Œéå·¥ä½œæ—¶é—´ä¼šå°½å¿«å›å¤</p>
      </div>
      <button onclick="window.closeModal()"><i class="fas fa-times"></i> å…³é—­</button>
    `
  }

  // APPä¸‹è½½å¼¹çª—
  function appDownloadModal() {
    return `
      <h3>APPä¸‹è½½</h3>
      <div>
        <h4><i class="fas fa-mobile-alt"></i> å®˜æ–¹APP</h4>
        <table>
          <thead>
            <tr>
              <th>å¹³å°</th>
              <th>è¯´æ˜</th>
              <th>ä¸‹è½½</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Android</strong></td>
              <td>Android 5.0+ ç³»ç»Ÿ</td>
              <td>
                <button onclick="window.open('https://xt.xinqianf152.top/2ySd')"><i class="fas fa-download"></i> ä¸‹è½½</button>
              </td>
            </tr>
            <tr>
              <td><strong>iOS</strong></td>
              <td>iOS 12.0+ ç³»ç»Ÿ</td>
              <td>
                <button onclick="window.open('https://xt.xinqianf152.top/s/upwrr')"><i class="fas fa-download"></i> ä¸‹è½½</button>
              </td>
            </tr>
            <tr>
              <td><strong>é€šç”¨ä¸‹è½½</strong></td>
              <td>æ‰€æœ‰å¹³å°é€šç”¨</td>
              <td>
                <button onclick="window.open('https://byphoto01.com/app/mg_xLYK')"><i class="fas fa-download"></i> ä¸‹è½½</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button onclick="window.closeModal()" style="margin-top:12px;"><i class="fas fa-times"></i> å…³é—­</button>
    `
  }

  // æ•™ç¨‹å¼¹çª—
  function tutorialModal(type) {
    const tutorials = {
      okx: {
        title: 'æ¬§æ˜“OKXæ³¨å†Œä½¿ç”¨æ•™ç¨‹',
        content: `<ol>
          <li>è®¿é—®æ¬§æ˜“OKXå®˜ç½‘æˆ–ä¸‹è½½APP</li>
          <li>æ³¨å†Œè´¦æˆ·ï¼Œå¡«å†™é‚®ç®±/æ‰‹æœºå’Œå¯†ç </li>
          <li>å®Œæˆèº«ä»½è®¤è¯å’Œå®‰å…¨è®¾ç½®</li>
          <li>å……å€¼å¹¶å¼€å§‹äº¤æ˜“</li>
        </ol>`
      },
      binance: {
        title: 'å¸å®‰Binanceæ³¨å†Œä½¿ç”¨æ•™ç¨‹',
        content: `<ol>
          <li>è®¿é—®å¸å®‰å®˜ç½‘å¹¶æ³¨å†Œè´¦æˆ·</li>
          <li>å®Œæˆé‚®ç®±éªŒè¯å’Œå®‰å…¨è®¾ç½®</li>
          <li>å¼€å¯åŒé‡éªŒè¯å’Œèº«ä»½è®¤è¯KYC</li>
          <li>å……å€¼å¹¶å¼€å§‹äº¤æ˜“</li>
        </ol>`
      },
      kd: {
        title: 'Kè±†é’±åŒ…ä½¿ç”¨æ•™ç¨‹',
        content: `<ol>
          <li>ä¸‹è½½å¹¶å®‰è£…Kè±†é’±åŒ…APP</li>
          <li>åˆ›å»ºæ–°é’±åŒ…ï¼Œå®‰å…¨å¤‡ä»½åŠ©è®°è¯</li>
          <li>ç®¡ç†é’±åŒ…è´¦æˆ·ï¼Œè¿›è¡Œæ”¶æ¬¾å’Œè½¬è´¦</li>
        </ol>`
      },
      trust: {
        title: 'Trust Walletæ•™ç¨‹',
        content: `<ol>
          <li>ä¸‹è½½å¹¶å®‰è£…Trust Wallet</li>
          <li>åˆ›å»ºæ–°é’±åŒ…å¹¶è®¾ç½®å¯†ç </li>
          <li>å¤‡ä»½åŠ©è®°è¯ï¼Œå®‰å…¨ç®¡ç†èµ„äº§</li>
        </ol>`
      },
      kuailianvpn: {
        title: 'å¿«è¿VPNä½¿ç”¨æ•™ç¨‹',
        content: `<ol>
          <li>ä¸‹è½½å¹¶å®‰è£…å¿«è¿VPN</li>
          <li>æ³¨å†Œè´¦æˆ·å¹¶ç™»å½•</li>
          <li>é€‰æ‹©æœåŠ¡å™¨èŠ‚ç‚¹è¿æ¥</li>
        </ol>`
      },
      shanlienvpn: {
        title: 'é—ªè¿VPNä½¿ç”¨æ•™ç¨‹',
        content: `<ol>
          <li>ä¸‹è½½å¹¶å®‰è£…é—ªè¿VPN</li>
          <li>æ³¨å†Œè´¦æˆ·å¹¶ç™»å½•</li>
          <li>é€‰æ‹©èŠ‚ç‚¹å¹¶è¿æ¥</li>
        </ol>`
      },
      nordvpn: {
        title: 'NordVPNä½¿ç”¨æ•™ç¨‹',
        content: `<ol>
          <li>è®¿é—®å®˜ç½‘è´­ä¹°æœåŠ¡</li>
          <li>ä¸‹è½½å¹¶å®‰è£…å®¢æˆ·ç«¯</li>
          <li>ç™»å½•è´¦æˆ·ï¼Œé€‰æ‹©èŠ‚ç‚¹è¿æ¥</li>
        </ol>`
      }
    };
    const data = tutorials[type] || tutorials['okx'];
    return `<h3>${data.title}</h3><div>${data.content}</div><button onclick="window.closeModal()" style="margin-top:12px;"><i class="fas fa-times"></i> å…³é—­</button>`;
  }

  // å¿«é€Ÿç™»å½•åŠŸèƒ½å®ç°
  window.startQuickLogin = function () {
    const statusDiv = document.getElementById('quick-login-status')

    // æ˜¾ç¤ºæ£€æµ‹è¿‡ç¨‹
    statusDiv.innerHTML = '<div style="color: #2196F3;"><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æ£€æµ‹æœ€ä½³åŸŸå...</div>'

    setTimeout(() => {
      statusDiv.innerHTML = '<div style="color: #FF9800;"><i class="fas fa-globe"></i> æ­£åœ¨æµ‹è¯•åŸŸåå“åº”é€Ÿåº¦...</div>'

      setTimeout(() => {
        // æ¨¡æ‹Ÿæ‰¾åˆ°æœ€å¿«çš„åŸŸå
        const fastestDomain = getBestDomain()
        statusDiv.innerHTML = `<div style="color: #4CAF50;"><i class="fas fa-check-circle"></i> å·²æ‰¾åˆ°æœ€ä½³åŸŸå: ${fastestDomain}</div>`

        setTimeout(() => {
          // ç›´æ¥è·³è½¬åˆ°æœ€å¿«çš„åŸŸå
          const loginUrl = `https://${fastestDomain}/?quickLogin=true&source=8yhot&timestamp=${Date.now()}`
          window.open(loginUrl, '_blank', 'noopener,noreferrer')
          window.closeModal()
          showToast(`å·²æ‰“å¼€ ${fastestDomain} ç™»å½•é¡µé¢`, 'success')
        }, 1000)
      }, 1500)
    }, 1000)
  }

  function getBestDomain() {
    const domains = [
      '8y369.com', '8y258.com', '8y68.com', '8yapp.com', '8y520.com',
      '8y668.com', '818by.com', '518by.com', '81svip.com', '8y98.com'
    ]
    // éšæœºé€‰æ‹©ä¸€ä¸ªåŸŸåä½œä¸º"æœ€å¿«"çš„
    return domains[Math.floor(Math.random() * domains.length)]
  }

  function generateMockIPInfo() {
    const locations = ['å¹¿ä¸œæ·±åœ³', 'åŒ—äº¬æœé˜³', 'ä¸Šæµ·æµ¦ä¸œ', 'æ±Ÿè‹å—äº¬', 'æµ™æ±Ÿæ­å·', 'å››å·æˆéƒ½'];
    const isps = ['ä¸­å›½ç”µä¿¡', 'ä¸­å›½è”é€š', 'ä¸­å›½ç§»åŠ¨', 'é•¿åŸå®½å¸¦'];
    const networkTypes = ['å…‰çº¤å®½å¸¦', '4G/5G', 'ADSL', 'ä¼ä¸šä¸“çº¿'];

    return {
      ip: `${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}`,
      location: locations[Math.floor(Math.random() * locations.length)],
      isp: isps[Math.floor(Math.random() * isps.length)],
      networkType: networkTypes[Math.floor(Math.random() * networkTypes.length)]
    };
  }

  function testDomainSpeeds() {
    // å®šä¹‰åŸŸååº“
    const domains = [
      '8y369.com', '8y258.com', '8y68.com', '8yapp.com', '8y520.com',
      '8y668.com', '818by.com', '518by.com', '81svip.com', '8y98.com'
    ];

    const domainList = document.getElementById('domain-speed-list');
    const testedDomains = [];

    // ä¸ºæ¯ä¸ªåŸŸåç”Ÿæˆæ¨¡æ‹Ÿçš„å“åº”æ—¶é—´
    domains.forEach(domain => {
      const responseTime = Math.floor(Math.random() * 800) + 100; // 100-900ms
      const status = responseTime < 300 ? 'excellent' : (responseTime < 500 ? 'good' : 'slow');
      const statusText = responseTime < 300 ? 'æé€Ÿ' : (responseTime < 500 ? 'æ­£å¸¸' : 'è¾ƒæ…¢');
      const statusColor = responseTime < 300 ? '#4CAF50' : (responseTime < 500 ? '#FF9800' : '#F44336');

      testedDomains.push({
        domain,
        responseTime,
        status,
        statusText,
        statusColor
      });
    });

    // æŒ‰å“åº”æ—¶é—´æ’åº
    testedDomains.sort((a, b) => a.responseTime - b.responseTime);

    // ç”ŸæˆåŸŸååˆ—è¡¨HTML
    const domainListHTML = testedDomains.map((item, index) => `
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin: 4px 0; border: 1px solid #e0e0e0; border-radius: 6px; background: ${index === 0 ? '#e8f5e9' : '#fafafa'};">
        <div style="flex: 1;">
          <div style="font-weight: 600; color: #333;">${item.domain}</div>
          <div style="font-size: 0.8em; color: #666;">
            ${index === 0 ? 'ğŸ† æœ€ä½³é€‰æ‹©' : `æ’å #${index + 1}`}
          </div>
        </div>
        <div style="text-align: center; margin: 0 12px;">
          <div style="font-weight: 600; color: ${item.statusColor};">${item.responseTime}ms</div>
          <div style="font-size: 0.8em; color: ${item.statusColor};">${item.statusText}</div>
        </div>
        <button onclick="window.open('https://${item.domain}', '_blank')" 
                style="background: ${index === 0 ? '#4CAF50' : '#2196F3'}; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
          ${index === 0 ? 'è®¿é—®æœ€å¿«' : 'è®¿é—®'}
        </button>
      </div>
    `).join('');

    domainList.innerHTML = domainListHTML;
  }

  // Toastæç¤ºå‡½æ•°
  function showToast(message, type = 'info') {
    const colors = {
      'success': 'linear-gradient(135deg, #4CAF50, #66BB6A)',
      'error': 'linear-gradient(135deg, #F44336, #EF5350)',
      'info': 'linear-gradient(135deg, #2196F3, #42A5F5)',
      'warning': 'linear-gradient(135deg, #FF9800, #FFB74D)'
    };

    const toast = document.createElement('div');
    toast.textContent = message;
    toast.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${colors[type] || colors.info};
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 10001;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      animation: slideInRight 0.3s ease-out;
      max-width: 300px;
      word-wrap: break-word;
    `;

    document.body.appendChild(toast);

    setTimeout(() => {
      if (toast.parentNode) {
        toast.style.animation = 'slideOutRight 0.3s ease-in';
        setTimeout(() => {
          if (toast.parentNode) {
            document.body.removeChild(toast);
          }
        }, 300);
      }
    }, 3000);
  }

  // å…¨å±€å…¥å£
  window.showQuickLoginModal = () => window.showModal('quick-login');
  window.showDomainVerifyModal = () => window.showModal('domain-verify');
  window.showIPSwitchModal = () => window.showModal('ip-switch');
  window.showVPNModal = () => window.showModal('vpn');
  window.showWalletModal = () => window.showModal('wallet');
  window.showRegisterModal = () => window.showModal('register');
  window.showCustomerServiceModal = () => window.showModal('customer');
  window.showAppDownloadModal = () => window.showModal('app-download');
  window.showToolsModal = () => window.showModal('tools');
  window.showTutorialModal = (tutorialType) => window.showModal('tutorial', { tutorialType });
}