<!DOCTYPE html>
<html lang="zh-CN">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè°ƒè¯•æ—¥å¿—</title>
    <style>
      body {
        font-family: monospace;
        margin: 20px;
        background: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
      }

      .log-section {
        margin: 20px 0;
      }

      .log-content {
        background: #1e1e1e;
        color: #fff;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        max-height: 400px;
        overflow-y: auto;
      }

      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background: #007bff;
        color: white;
      }

      .error {
        color: #e23b21;
      }

      .success {
        color: #51cf66;
      }

      .info {
        color: #74c0fc;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>ğŸ” APIè°ƒè¯•æ—¥å¿—æŸ¥çœ‹å™¨</h1>

      <div>
        <button onclick="loadLogs('test')">æµ‹è¯•APIæ—¥å¿—</button>
        <button onclick="loadLogs('proxy')">ä»£ç†APIæ—¥å¿—</button>
        <button onclick="clearLogs()">æ¸…é™¤æ˜¾ç¤º</button>
        <button onclick="testAPI()">å¿«é€Ÿæµ‹è¯•API</button>
      </div>

      <div class="log-section">
        <h3>ğŸ“‹ æ—¥å¿—å†…å®¹</h3>
        <div id="logContent" class="log-content">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½æ—¥å¿—...</div>
      </div>

      <div class="log-section">
        <h3>ğŸ§ª å¿«é€Ÿæµ‹è¯•</h3>
        <div id="testResult" class="log-content">æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
      </div>
    </div>

    <script>
      async function loadLogs(type) {
        const logContent = document.getElementById('logContent');
        logContent.innerHTML = 'æ­£åœ¨åŠ è½½æ—¥å¿—...';

        try {
          let logFile = '';
          if (type === 'test') {
            logFile = '/api/logs/test_register.log';
          } else if (type === 'proxy') {
            logFile = '/api/logs/proxy_register.log';
          }

          const response = await fetch(logFile);
          if (response.ok) {
            const logText = await response.text();
            if (logText.trim()) {
              logContent.innerHTML = '<pre>' + logText + '</pre>';
            } else {
              logContent.innerHTML = '<span class="info">æ—¥å¿—æ–‡ä»¶ä¸ºç©º</span>';
            }
          } else {
            logContent.innerHTML = '<span class="error">æ— æ³•åŠ è½½æ—¥å¿—æ–‡ä»¶ (HTTP ' + response.status + ')</span>';
          }
        } catch (error) {
          logContent.innerHTML = '<span class="error">åŠ è½½æ—¥å¿—æ—¶å‘ç”Ÿé”™è¯¯: ' + error.message + '</span>';
        }
      }

      function clearLogs() {
        document.getElementById('logContent').innerHTML = 'æ—¥å¿—å·²æ¸…é™¤æ˜¾ç¤º';
        document.getElementById('testResult').innerHTML = 'æµ‹è¯•ç»“æœå·²æ¸…é™¤';
      }

      async function testAPI() {
        const testResult = document.getElementById('testResult');
        testResult.innerHTML = 'æ­£åœ¨è¿›è¡ŒAPIæµ‹è¯•...';

        const tests = [];

        // æµ‹è¯•1: æ£€æŸ¥æµ‹è¯•APIçŠ¶æ€
        tests.push(testTestAPI());

        // æµ‹è¯•2: æ£€æŸ¥ä»£ç†APIçŠ¶æ€
        tests.push(testProxyAPI());

        try {
          const results = await Promise.all(tests);
          let output = '';

          results.forEach((result, index) => {
            output += `æµ‹è¯• ${index + 1}: ${result}\n`;
          });

          testResult.innerHTML = '<pre>' + output + '</pre>';
        } catch (error) {
          testResult.innerHTML = '<span class="error">æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message + '</span>';
        }
      }

      async function testTestAPI() {
        try {
          const response = await fetch('/api/test-register.php');
          const data = await response.json();
          return `<span class="success">âœ… æµ‹è¯•APIæ­£å¸¸</span> - ${data.status}`;
        } catch (error) {
          return `<span class="error">âŒ æµ‹è¯•APIå¼‚å¸¸</span> - ${error.message}`;
        }
      }

      async function testProxyAPI() {
        try {
          const response = await fetch('/api/proxy-register.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              targetSite: 'test.8yhot.com',
              registrationData: {
                email: 'debug@test.com',
                password: '123456',
                username: 'è°ƒè¯•ç”¨æˆ·'
              }
            })
          });
          const data = await response.json();
          if (data.success) {
            return `<span class="success">âœ… ä»£ç†APIæ­£å¸¸</span> - æ³¨å†ŒæˆåŠŸ`;
          } else {
            return `<span class="info">âš ï¸ ä»£ç†APIå“åº”</span> - ${data.message}`;
          }
        } catch (error) {
          return `<span class="error">âŒ ä»£ç†APIå¼‚å¸¸</span> - ${error.message}`;
        }
      }
    </script>
  </body>

</html>