<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿç™»å½•æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #2196F3;
            background: #f9f9f9;
        }
        .test-section h3 {
            margin-top: 0;
            color: #2196F3;
        }
        .code {
            background: #272822;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #1976D2;
        }
        .result {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
        }
        .error {
            background: #ffebee;
            border-left-color: #337ef7;
            color: #314dff;
        }
        .success {
            background: #e8f5e9;
            border-left-color: #4caf50;
            color: #2e7d32;
        }
        #output {
            margin-top: 15px;
        }
        pre {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª å¿«é€Ÿç™»å½•åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>1. æµ‹è¯•åŸŸååˆ—è¡¨ API</h3>
            <p>è·å– /api/domains-list å¹¶éªŒè¯è¿”å›æ•°æ®</p>
            <button onclick="testDomainsAPI()">æµ‹è¯• API</button>
            <div id="api-result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. æµ‹è¯•åŸŸåæ©ç›–å‡½æ•°</h3>
            <p>æµ‹è¯•åŸŸåæ˜¾ç¤ºæ©ç›–é€»è¾‘</p>
            <button onclick="testMaskDomain()">æµ‹è¯•æ©ç›–</button>
            <div id="mask-result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. æµ‹è¯• Base64 ç¼–ç </h3>
            <p>æµ‹è¯•æºä¿¡æ¯çš„ç¼–ç å’Œè§£ç </p>
            <button onclick="testEncoding()">æµ‹è¯•ç¼–ç </button>
            <div id="encode-result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. æ¨¡æ‹Ÿå¿«é€Ÿç™»å½•è·³è½¬</h3>
            <p>ç”Ÿæˆå®Œæ•´çš„è·³è½¬ URL</p>
            <button onclick="generateLoginURL()">ç”Ÿæˆ URL</button>
            <div id="url-result"></div>
        </div>
        
        <div class="test-section">
            <h3>5. æ£€æŸ¥å½“å‰ URL å‚æ•°</h3>
            <p>å¦‚æœä»å¿«é€Ÿç™»å½•è·³è½¬è¿‡æ¥ï¼Œæ˜¾ç¤ºè§£ç åçš„ä¿¡æ¯</p>
            <button onclick="checkCurrentURL()">æ£€æŸ¥å‚æ•°</button>
            <div id="url-check-result"></div>
        </div>
    </div>

    <script>
        function formatJSON(obj) {
            return JSON.stringify(obj, null, 2);
        }

        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${isError ? 'error' : 'success'}">${message}</div>`;
        }

        function showCode(elementId, code) {
            const element = document.getElementById(elementId);
            element.innerHTML += `<div class="code">${code}</div>`;
        }

        // 1. æµ‹è¯• API
        async function testDomainsAPI() {
            try {
                const response = await fetch('/api/domains-list');
                const data = await response.json();
                
                let html = `<div class="result success">
                    <strong>âœ“ API å“åº”æˆåŠŸ</strong><br>
                    åŸŸåæ€»æ•°: ${data.domains.length}<br>
                    å‰ 5 ä¸ªåŸŸå: ${data.domains.slice(0, 5).join(', ')}
                </div>`;
                html += `<pre>${formatJSON(data)}</pre>`;
                
                document.getElementById('api-result').innerHTML = html;
            } catch (error) {
                showResult('api-result', `âœ— API è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }

        // 2. æµ‹è¯•æ©ç›–å‡½æ•°
        function maskDomain(domain) {
            const parts = domain.split('.');
            if (parts.length < 2) return domain;
            
            const firstPart = parts[0];
            const lastPart = parts[parts.length - 1];
            
            if (firstPart.length > 2) {
                const masked = firstPart.charAt(0) + '*'.repeat(Math.max(1, firstPart.length - 2)) + firstPart.charAt(firstPart.length - 1);
                return masked + '...' + lastPart;
            }
            
            return domain;
        }

        function testMaskDomain() {
            const testDomains = [
                '8y258.com',
                '81yx.vip',
                'www.8y98.com',
                'game.8y98.com',
                'dl.518by.com'
            ];
            
            let html = '<div class="result success"><strong>âœ“ æ©ç›–ç»“æœ:</strong><br>';
            testDomains.forEach(domain => {
                const masked = maskDomain(domain);
                html += `${domain} â†’ <strong>${masked}</strong><br>`;
            });
            html += '</div>';
            
            document.getElementById('mask-result').innerHTML = html;
        }

        // 3. æµ‹è¯•ç¼–ç 
        function testEncoding() {
            const sourceData = {
                from: '8yhot.com',
                timestamp: Date.now(),
                type: 'quick-login'
            };
            
            const encoded = btoa(JSON.stringify(sourceData));
            const urlEncoded = encodeURIComponent(encoded);
            const decoded = JSON.parse(atob(decodeURIComponent(urlEncoded)));
            
            let html = `<div class="result success"><strong>âœ“ ç¼–ç /è§£ç æˆåŠŸ</strong></div>`;
            html += `<strong>åŸå§‹æ•°æ®:</strong>`;
            html += `<pre>${formatJSON(sourceData)}</pre>`;
            html += `<strong>Base64 ç¼–ç :</strong>`;
            html += `<pre>${encoded}</pre>`;
            html += `<strong>URL ç¼–ç :</strong>`;
            html += `<pre>${urlEncoded}</pre>`;
            html += `<strong>è§£ç åçš„æ•°æ®:</strong>`;
            html += `<pre>${formatJSON(decoded)}</pre>`;
            
            document.getElementById('encode-result').innerHTML = html;
        }

        // 4. ç”Ÿæˆç™»å½• URL
        async function generateLoginURL() {
            try {
                const response = await fetch('/api/domains-list');
                const data = await response.json();
                
                if (!data.domains || data.domains.length === 0) {
                    showResult('url-result', 'âœ— åŸŸååˆ—è¡¨ä¸ºç©º', true);
                    return;
                }
                
                const selectedDomain = data.domains[Math.floor(Math.random() * data.domains.length)];
                const sourceData = {
                    from: '8yhot.com',
                    timestamp: Date.now(),
                    type: 'quick-login'
                };
                
                const encoded = btoa(JSON.stringify(sourceData));
                const loginUrl = `https://${selectedDomain}/?quickLogin=true&source=${encodeURIComponent(encoded)}`;
                
                let html = `<div class="result success">
                    <strong>âœ“ ç”ŸæˆæˆåŠŸ</strong><br>
                    <strong>é€‰ä¸­çš„åŸŸå:</strong> ${selectedDomain}<br>
                </div>`;
                html += `<strong>å®Œæ•´ URL:</strong>`;
                html += `<pre>${loginUrl}</pre>`;
                html += `<button onclick="window.open('${loginUrl}', '_blank')">æ‰“å¼€é“¾æ¥</button>`;
                
                document.getElementById('url-result').innerHTML = html;
            } catch (error) {
                showResult('url-result', `âœ— ç”Ÿæˆå¤±è´¥: ${error.message}`, true);
            }
        }

        // 5. æ£€æŸ¥å½“å‰ URL
        function checkCurrentURL() {
            const params = new URLSearchParams(window.location.search);
            const quickLogin = params.get('quickLogin');
            const source = params.get('source');
            
            if (!quickLogin || !source) {
                showResult('url-check-result', 'å½“å‰é¡µé¢æ²¡æœ‰å¿«é€Ÿç™»å½•å‚æ•°', false);
                return;
            }
            
            try {
                const decodedSource = atob(decodeURIComponent(source));
                const sourceData = JSON.parse(decodedSource);
                
                let html = `<div class="result success">
                    <strong>âœ“ æ£€æµ‹åˆ°å¿«é€Ÿç™»å½•è·³è½¬</strong><br>
                    <strong>æ¥æº:</strong> ${sourceData.from}<br>
                    <strong>æ—¶é—´æˆ³:</strong> ${sourceData.timestamp}<br>
                    <strong>ç±»å‹:</strong> ${sourceData.type}<br>
                    <strong>å½“å‰åŸŸå:</strong> ${window.location.hostname}<br>
                    <strong>æ©ç›–æ˜¾ç¤º:</strong> ${maskDomain(window.location.hostname)}
                </div>`;
                html += `<strong>è§£ç åçš„å®Œæ•´æ•°æ®:</strong>`;
                html += `<pre>${formatJSON(sourceData)}</pre>`;
                
                document.getElementById('url-check-result').innerHTML = html;
            } catch (error) {
                showResult('url-check-result', `âœ— è§£ç å¤±è´¥: ${error.message}`, true);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', checkCurrentURL);
    </script>
</body>
</html>
